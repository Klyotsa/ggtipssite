# Инструкция по миграции базы данных для поддержки баланса и покупок пользователей

## 1. Резервное копирование (ОБЯЗАТЕЛЬНО)
Перед любыми изменениями выполните резервное копирование вашей базы данных через phpMyAdmin или командную строку:

- В phpMyAdmin: выберите базу данных → Экспорт → Быстрый → SQL → Скачать файл.
- В командной строке:
  ```sh
  mysqldump -u <user> -p <database> > backup_before_balance.sql
  ```

## 2. Запуск миграции

1. Откройте phpMyAdmin или любой другой SQL-клиент, подключённый к вашей базе данных.
2. Откройте файл `backend/api/create_balance_tables.sql`.
3. Скопируйте содержимое файла и выполните его в SQL-консоли вашей базы данных.
   - В phpMyAdmin: вкладка SQL → вставьте содержимое → Выполнить.
   - В командной строке:
     ```sh
     mysql -u <user> -p <database> < backend/api/create_balance_tables.sql
     ```

## 3. Проверка

- Убедитесь, что появились две новые таблицы: `user_balance` и `purchases`.
- В таблице `user_balance` для каждого пользователя будет храниться его текущий баланс.
- В таблице `purchases` будут фиксироваться все покупки пользователей.
- В таблице `purchases` теперь есть поле `status` (ENUM: 'pending', 'paid', 'failed') для хранения статуса платежа.

## 4. (Опционально) Инициализация баланса для существующих пользователей

Если у вас уже есть пользователи, и вы хотите задать им начальный баланс (например, 0):

```sql
INSERT INTO user_balance (user_id, balance)
SELECT id, 0 FROM users
ON DUPLICATE KEY UPDATE balance = balance;
```

## 5. Готово

Теперь вы можете использовать новые API-эндпоинты для пополнения баланса, совершения покупок и просмотра истории покупок.

**Для интеграции с платежной системой:**
- Используйте поле `status` в таблице `purchases` для отслеживания состояния платежа (например, сначала 'pending', после успешной оплаты — 'paid', при ошибке — 'failed').

---

**В случае ошибок или вопросов — обратитесь к разработчику или администратору базы данных.** 